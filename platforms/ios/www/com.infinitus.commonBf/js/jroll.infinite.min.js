/*! JRoll.Infinite v1.0.4 ~ (c) 2015
 *Author:jlong
 *Email:jlong@chjtx.com
 *Website:http://www.chjtx.com/JRoll/#todo/tutorial?do=infinite
 */
!function(a,b){"use strict";function g(a){return b.getElementById(a)}function h(a){return b.querySelector(a)}function i(a){return b.createElement(a)}function j(){for(var a=["a","b","c","d","e","f","g","h","i","j"],b="",c=5;c--;)b+=a[parseInt(10*Math.random(),10)];return b+"_"}function k(a){var b=a,c="'use strict';\nvar __t='';__t+='",d=0,e=/\{\{=([^\{]+)\}\}|\{\{(each [\w\$\._]+ as [\w\$_]+ [\w\$_]+)\}\}|\{\{if ([^\{]+)\}\}|\{\{(else)\}\}|\{\{else if ([^\{]+)\}\}|(\{\{\/each\}\}|\{\{\/if\}\})|\{\{([^\{]+)\}\}/g;return b=b.replace(/(\n|\r)|(\{\{\s+)|(\s+\}\})|(\s{2,})|(')/g,function(a,b,c,d,e,f){var g;return b?g="":c?g="{{":d?g="}}":e?g=" ":f&&(g="\\'"),g}),b.replace(e,function(a,e,f,g,h,i,j,k,l){if(c+=b.slice(d,l),d=l+a.length,e)c+="'+("+e+")+'";else if(f){var m=f.split(" ");c+="';\nfor(var "+m[4]+"=0,"+m[3]+";"+m[4]+"<"+m[1]+".length;"+m[4]+"++){\n"+m[3]+"="+m[1]+"["+m[4]+"];\n__t+='"}else g?c+="';\nif("+g+"){\n__t+='":h?c+="';\n}else{\n__t+='":i?c+="';\n}else if("+i+"){\n__t+='":j?c+="';\n};\n__t+='":k&&(c+="';\n"+k+";\n__t+='");return a}),c+=b.slice(d)+"';return __t;",new Function("_obj",c)}function l(a,b){return a(b)}function m(a,b,c){var m,n,o,f=this;f.page=1,f.id=null,f.refresh=!1,f.lock=!1,f.prefix=j(),f.direction="+",f.options={jroll:null,total:10,limit:!1,pullCss:"position:absolute;top:-42px;left:0;width:100%;height:42px;line-height:42px;text-align:center;display:block;",iconPull:"\u2193",iconUpdate:"\u21bb",iconFinish:"\u221a",iconCss:"display:inline-block;width:42px;",textPull:"\u4e0b\u62c9\u5237\u65b0",textRelease:"\u91ca\u653e\u5237\u65b0",textUpdate:"\u6b63\u5728\u52a0\u8f7d",textFinish:"\u5237\u65b0\u5b8c\u6210",textCss:"",getData:null,template:"",loadingTip:'<div class="jroll-infinite-tip">\u6b63\u5728\u52a0\u8f7d...</div>',completeTip:'<div class="jroll-infinite-tip">\u5df2\u52a0\u8f7d\u5168\u90e8\u5185\u5bb9</div>',compile:k,render:l};for(m in b)f.options[m]=b[m];"object"!=typeof c&&(c={bounce:!0,scrollX:!1}),f.compiled=f.options.compile(f.options.template),n=f.options.loadingTip.replace(/<img.+?\/>/,".+?"),o=f.options.completeTip.replace(/<img.+?\/>/,".+?"),f.clearRegExp=new RegExp("("+n+"|"+o+")","g"),f.jroll="function"==typeof f.options.jroll?new f.options.jroll(a,c):new JRoll(a,c),f.jroll.scroller.id||(f.jroll.scroller.id=f.prefix+"jroll"),f.id=f.jroll.scroller.id,f.jroll.on("scrollEnd",function(){f.lock||(this.y>-1*h("#"+f.id+" .jroll-infinite-tip").offsetHeight&&f.options.limit&&("-"===f.direction?f.page-1>=1&&(f.page=f.page-1,f.getData()):f.page-3>=1&&(f.page=f.page-3,f.direction="-",f.getData())),this.y<this.maxScrollY+h("#"+f.id+" .jroll-infinite-tip").offsetHeight&&("+"===f.direction?f.page+1<=f.options.total&&(f.page=f.page+1,f.getData()):f.page+3<=f.options.total&&(f.page=f.page+3,f.direction="+",f.getData())))}),f.divPull=i("div"),f.divIcon=i("span"),f.divText=i("span"),f.setText(f.options.iconPull,f.options.textPull),f.divPull.style.cssText=f.options.pullCss,f.divIcon.style.cssText=f.options.iconCss,f.divText.style.cssText=f.options.textCss,f.divIcon.style[e]="200ms",f.divPull.appendChild(f.divIcon),f.divPull.appendChild(f.divText),f.jroll.wrapper.appendChild(f.divPull),f.jroll.on("scroll",function(){f.divPull.style[d]="translateY("+this.y+"px)",f.lock||(this.y>=f.divPull.offsetHeight&&g(f.prefix+"page_1")?f.refresh||(f.refresh=!0,f.divText.innerHTML=f.options.textRelease,f.divIcon.style[d]="rotateZ(180deg)"):f.refresh&&(f.refresh=!1,f.divText.innerHTML=f.options.textPull,f.divIcon.style[d]="rotateZ(0deg)"))}),f.jroll.scroller.addEventListener("touchend",function(){f.refresh&&!f.lock&&(f.jroll.options.momentum=!1,f.jroll.options.bounce=!1,f.jroll.scroller.style[e]="200ms",f.jroll.scroller.style[d]="translate(0px, "+f.divPull.offsetHeight+"px) translateZ(0) scale("+f.jroll._zoom.scale+")",f.divPull.style[e]="200ms",f.divPull.style[d]="translateY("+f.divPull.offsetHeight+"px)",setTimeout(function(){f.jroll.scroller.style[e]="0ms",f.divPull.style[e]="0ms"},200),f.setLoading(),f.page=1,f.getData())},!1),f.init()}var c=b.createElement("div").style,d="transform"in c?"transform":"-webkit-transform",e="transitionDuration"in c?"transition-duration":"-webkit-transition-duration",f=function(a){var c,b=a.getElementsByTagName("script");for(c=b.length-1;c>-1;c--)if("normal"===b[c].getAttribute("jroll-import"))return!0;return!1}(b);!function(a){if(!g("jroll_infinite_style")){var b=i("style");b.id="jroll_infinite_style",b.innerHTML=".jroll-infinite-loading{-webkit-animation:jroll_infinite_loading 600ms linear infinite;animation:jroll_infinite_loading 600ms linear infinite}@-webkit-keyframes jroll_infinite_loading{from{-webkit-transform:rotateZ(0deg)}to{-webkit-transform:rotateZ(360deg)}}@keyframes jroll_infinite_loading{from{transform:rotateZ(0deg)}to{transform:rotateZ(360deg)}}",a.head.appendChild(b)}}(b),m.prototype={init:function(){var a=this;a.getData()},setLoading:function(){var a=this;a.divIcon.className="jroll-infinite-loading",setTimeout(function(){a.setText(a.options.iconUpdate,a.options.textUpdate)},30)},setText:function(a,b){var c=this;c.divIcon.innerHTML=a,c.divText.innerHTML=b},getData:function(){var a=this;a.lock=!0,"block"===a.divPull.style.display&&a.setLoading(),a.options.getData(a.page,a.callback.bind(a))},callback:function(a){var c,f,i,j,k,l,b=this;for(b.lock=!1,j="<section id='"+b.prefix+"page_"+b.page+"'>",k=0,l=a.length;l>k;k++)j+=b.options.render(b.compiled,a[k],k);j+="</section>",b.divIcon.className="",b.divIcon.style[d]="rotateZ(360deg)",b.refresh?(b.direction="+",b.jroll.options.momentum=!0,b.jroll.options.bounce=!0,b.jroll.scroller.innerHTML="",b.setText(b.options.iconFinish,b.options.textFinish)):b.setText(b.options.iconPull,b.options.textPull),"-"===b.direction&&(f=g(b.prefix+"page_"+(b.page+3)),i=1,b.jroll.scroller.removeChild(f),c=1!==b.page?b.options.loadingTip+j+b.jroll.scroller.innerHTML.replace(b.clearRegExp,""):j+b.jroll.scroller.innerHTML.replace(b.clearRegExp,"")),"+"===b.direction&&(b.page-3>0?b.options.limit?(f=g(b.prefix+"page_"+(b.page-3)),i=4===b.page?f.offsetHeight-h("#"+b.id+" .jroll-infinite-tip").offsetHeight:f.offsetHeight,b.jroll.scroller.removeChild(f),c=b.options.loadingTip+b.jroll.scroller.innerHTML.replace(b.clearRegExp,"")+j):(i=0,c=b.jroll.scroller.innerHTML.replace(b.clearRegExp,"")+j):c=b.jroll.scroller.innerHTML.replace(b.clearRegExp,"")+j),c+=b.page!==b.options.total?b.options.loadingTip:b.options.completeTip,b.jroll.scroller.innerHTML=c,i&&("+"===b.direction?b.jroll.scrollTo(0,b.jroll.y+i):(i=1===b.page?b.jroll.scroller.children[0].offsetHeight-h("#"+b.id+" .jroll-infinite-tip").offsetHeight:b.jroll.scroller.children[1].offsetHeight,b.jroll.scrollTo(0,b.jroll.y-i))),b.jroll.refresh(),b.divPull.style.display=g(b.prefix+"page_1")?"block":"none",b.refresh&&(setTimeout(function(){b.jroll.scrollTo(0,0,400),b.divPull.style[e]="400ms",b.divPull.style[d]="translateY(0px)",setTimeout(function(){b.divPull.style[e]="0ms",b.setText(b.options.iconPull,b.options.textPull)},400)},800),b.refresh=!1)}},"undefined"!=typeof module&&module.exports&&!f?module.exports=m:"function"!=typeof define||f?a.JRoll_Infinite=m:define(function(){return m})}(window,document);